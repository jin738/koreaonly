
@{
    ViewBag.Title = "Index2";
    Layout = "~/Views/Default.cshtml";
}

<style>
    /* Style the input container */
    .input-container {
        display: flex;
        margin-bottom: 15px;
    }

    /* Style the form icons */
    .icons {
        padding: 10px;
        background: #1f4d65;
        color: white;
        min-width: 50px;
        text-align: center;
    }

    /* Style the input fields */
    .input-field {
        padding: 10px !important;
        outline: none !important;
        border: 0px !important;
        width: 100% !important;
        font-weight: bold !important;
        font-size: 14px !important;
        height: 45px !important;
        border-radius: 0px !important;
    }

        .input-field:focus {
            color: #1f4d65 !important;
        }

    /* Set a style for the submit button */
    .button {
        border: none;
        padding: 0px 10px;
        color: #fff;
        background: #1f4d65;
        font-weight: bold;
    }

        .button:hover {
            background: #113040;
        }

    .cheap-flights-country {
        font-weight: bold;
        font-size: 14px;
        color: #7d8184;
        margin-bottom: 0px;
    }

    .cheap-flights-city {
        font-weight: bold;
        font-size: 18px;
        color: #1f4d65;
        margin-bottom: 0px;
    }

    .backgroundimage {
        background: url('/Images/plane.jpg') repeat;
        width: 100%;
        background-position: center;
        min-height: 400px;
        background-size: cover;
        padding-top: 20px;
    }

    .subheading {
        font-family: "Lato", sans-serif;
        line-height: 1;
        color: #fff;
        margin: 0 0 10px 0;
        font-size: 25px;
        text-shadow: 0 2px 1px rgba(0, 0, 0, 0.1);
        font-weight: 900;
        text-align: left;
    }

    .dropdowncustom {
        border: none !important;
        border-radius: 0px !important;
        height: auto !important;
        width: 300px !important;
        font-weight: bold !important;
    }

    .triptypeActive {
        background-color: #1f4d65;
        color: #fff;
    }

    .triptype {
        font-weight: bold;
        color: #fff;
        padding: 10px;
        display: inline-block;
        border: 1px solid hsl(201, 53%, 26%);
        margin-bottom: 15px;
        cursor: pointer;
    }

        .triptype:hover {
            background-color: #1f4d65 !important;
            color: #fff !important;
        }

    .easy-autocomplete {
        width: 100% !important;
    }

    .border {
        border: 1px solid red !important;
    }
</style>



<div class="row">


    <div class="col-md-12 col-sm-12 col-xs-12 backgroundimage" style="min-height:400px !important;">


        <div class="col-md-12 col-sm-12 col-xs-12">

            <div class="clearfix"></div>
            <br />
            <h2 id="flightsearch" style="display:none; text-align: center;color: #fff;font-weight: bold;">
                Please Wait Let us Find a Best Flight For You...
            </h2>
        </div>


        <div class="col-md-12 col-sm-12 col-xs-12" id="flightsearchpanel" style="float:right;padding: 10px 100px;">

            <div class="col-md-12 col-sm-12 col-xs-12">
                <p class="subheading"> SEARCH FLIGHT</p>



            </div>

            <div class="clearfix"></div>
            <div class="col-md-12 col-sm-12 col-xs-12">


                <span class="triptype triptypeActive" data-mode="rt">Round Trip</span>
                <span class="triptype" data-mode="ot">One Way</span>
                <span class="triptype" data-mode="mt">Multi City</span>



            </div>




            <div class="clearfix"></div>

            <form class="form" id="frmsearchflight" action="/Index/SearchFlight" method="get" autocomplete="off">
                <input type="text" name="triptype2" style="display: none;" id="triptypetext" value="0" autocomplete="off">
                <input type="text" name="triptype" style="display: none;" id="triptypetext1" value="0" autocomplete="off">

                <div class="col-md-12 col-sm-12 col-xs-12">

                    <div class="col-md-4 col-sm-12 col-xs-12">

                        <div class="form-group input-container">
                            <i class="material-icons icons">flight_takeoff</i>
                            <input name="OriginAirportCode" id="OriginAirportCode1" data-airportname="yes" autocomplete="off" class="input-field" type="text" placeholder="Leaving From">
                        </div>

                    </div>

                    <div class="col-md-4 col-sm-12 col-xs-12">

                        <div class="form-group input-container">
                            <i class="material-icons icons">flight_land</i>
                            <input name="DestinationAirportCode" id="DestinationAirportCode1" data-airportname="yes" autocomplete="off" class="input-field" type="text" placeholder="Going To">
                        </div>

                    </div>

                    <div class="col-md-4 col-sm-12 col-xs-12">

                        <div class="form-group input-container">
                            <i class="material-icons icons">date_range</i>
                            <input id="DepartureDate1" name="DepartureDate" autocomplete="off" type="text" class="input-field datepicker" placeholder="Departure Date" />
                        </div>

                        <div class="form-group input-container" id="contarrivedate">
                            <i class="material-icons icons">date_range</i>
                            <input id="arrivedate" name="arrivedate" autocomplete="off" type="text" class="input-field datepicker" placeholder="Arrival Date" />
                        </div>
                    </div>


                </div>

                <div id="multicityarea" style="display: none;">

                </div>

                <div class="col-md-12 col-sm-12 col-xs-12 multicityareaButtons" style="display: none;">
                    <div class="col-md-2 col-sm-12 col-xs-12">
                        <div class="form-group input-container button-container">
                            <i class="material-icons icons">remove</i>
                            <input type="button" class="button" value="Remove" id="removebtnmulticity" />
                        </div>
                    </div>

                    <div class="col-md-2 col-sm-12 col-xs-12">
                        <div class="form-group input-container button-container" id="addsegmulticityDiv">
                            <i class="material-icons icons">add</i>
                            <input type="button" class="button" value="Add Segment" id="addsegmulticity" />
                        </div>
                    </div>

                </div>


                <div class="col-md-12 col-sm-12 col-xs-12">
                    <hr />
                </div>


                <div class="col-md-12 col-sm-12 col-xs-12">

                    <div class="col-md-3 col-sm-12 col-xs-12">

                        <div class="form-group input-container">
                            <i class="material-icons icons">person</i>
                            <input class="input-field" name="trvaud" type="number" min="1" value="1" max="10"
                                   placeholder="Adults (12+)">
                        </div>
                    </div>


                    <div class="col-md-3 col-sm-12 col-xs-12">
                        <div class="form-group input-container">
                            <i class="material-icons icons">person</i>
                            <input class="input-field" name="trvchild" type="number" min="0" value="0" max="10" placeholder="Child">
                        </div>
                    </div>

                    <div class="col-md-3 col-sm-12 col-xs-12">
                        <div class="form-group input-container">
                            <i class="material-icons icons">flight</i>
                            <select name="flightclass" class="form-control dropdowncustom">
                                <option selected="selected" value="Y">Economy</option>
                                <option value="S">Premium Economy</option>
                                <option value="C">Business</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-3 col-sm-12 col-xs-12">
                        <div class="form-group input-container">
                            <i class="material-icons icons">flight</i>
                            <input id="Airline" name="airlinename" type="text" class="input-field" data-optional="1"
                                   placeholder="Airline" />
                        </div>
                    </div>

                </div>

                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="col-md-4 col-sm-12 col-xs-12">


                        <div class="form-group input-container button-container">
                            <i class="material-icons icons">search</i>
                            <button class="button" type="button" id="submitnow">Search Flight</button>
                            <input type="submit" style="display: none;" id="submitreal" class="btn btn-default"
                                   value="Search Flight" />
                        </div>



                    </div>
                </div>




            </form>

        </div>
    </div>


</div>




<div class="clearfix"></div>

<style>
    .cheap-flight-subhead {
        text-align: center;
        font-weight: normal;
        color: #444;
    }
</style>

<div class="row">

    <div class="col-md-12" style="padding:20px">


        <h2 class="text-center" style="font-weight:bold;color:#1f4d65;">Cheap Flights</h2>

        <p class="cheap-flight-subhead">Fly from <b id="CurrentCity">Karachi</b> to your favorite cities</p>

    </div>
</div>

<style>
    .cheap-flights-country {
        font-weight: bold;
        font-size: 14px;
        color: #7d8184;
        margin-bottom: 0px;
    }

    .cheap-flights-city {
        font-size: 17px;
        color: #1f4d65;
        margin-bottom: 0px;
    }
</style>

<div class="row" style="margin-top:20px;margin-bottom:20px;">

    <div class="col-md-12" id="CheapFlightPanelList">

        <h2 class="text-center font-weight-bold">Loading.....</h2>


    </div>

</div>

@section scriptarea{

    <script src="~/scripts/picker.js"></script>
    <script src="~/scripts/pickerdate.js"></script>

    <script>
        $(document).ready(function () {


            AddSearch("OriginAirportCode1");
            AddSearch("DestinationAirportCode1");

            AddAirlineSearch("Airline");
            AddValidation();

            $('#arrivedate').prop('disabled', true);

            window.dp1 = $('#DepartureDate1').pickadate({
                min: new Date(),
                format: 'dddd, dd mmm, yyyy',
                formatSubmit: 'yyyy/mm/dd',
                hiddenName: true,
                hiddenPrefix: 'prefix__',
                hiddenSuffix: '',
                onSet: function (thingSet) {

                    if ($("#triptypetext").val() == "0") {
                        $('#arrivedate').prop('disabled', false);
                        $('#arrivedate').focus();
                    }


                }
            });



            window.ari1 = $('#arrivedate').pickadate({
                min: new Date(),
                format: 'dddd, dd mmm, yyyy',
                formatSubmit: 'yyyy/mm/dd',
                hiddenName: true,
                hiddenPrefix: 'prefix__',
                hiddenSuffix: '',
                onSet: function (thingSet) {

                }
            });


            $(".triptype").click(function () {
                var mode = $(this).data('mode');

                $(".triptype").removeClass("triptypeActive");

                $(this).addClass("triptypeActive");


                $("#arrivedate").prop("disabled", false);
                $("#contarrivedate").hide();
                $(".multicityareaButtons").hide();
                $("#multicityarea").hide();

                $("#multicityarea input[type='text']").prop("disabled", true);



                if (mode == 'rt') {

                    $("#triptypetext").val("0");

                    $("#triptypetext1").val("0");


                    $("#contarrivedate").show();
                    if ($("#DepartureDate1").val() == "") {
                        $("#arrivedate").prop("disabled", true);
                    }

                } else if (mode == 'ot') {
                    $("#triptypetext").val("1");
                    $("#triptypetext1").val("1");

                    $("#arrivedate").prop("disabled", true);
                } else if (mode == 'mt') {
                    $("#arrivedate").attr("disabled", true);
                    $("#triptypetext").val("2");
                    $("#triptypetext1").val("2");

                    $(".multicityareaButtons").show();
                    $("#multicityarea").show();

                    $("#multicityarea input[type='text']").prop("disabled", false);
                    $("#arrivedate").prop("disabled", true);
                }
            });

            $("#removebtnmulticity").click(function () {
                $(".MulticitySegment").last().remove();
                var count = $(".MulticitySegment").length;

                if (count < 4) {
                    $("#addsegmulticityDiv").show();
                }


            });


            $("#addsegmulticity").click(function () {

                var count = $(".MulticitySegment").length;

                if (count < 4) {

                    var OriginAirportCodeID = "OriginAirportCode" + (count + 2);
                    var DestinationAirportCodeID = "DestinationAirportCode" + (count + 2);
                    var DepartureDateID = "DepartureDate" + (count + 2);




                    var MulticitySegmentDiv =
                        "<div class='col-md-12 col-sm-12 col-xs-12 MulticitySegment'><div class='col-md-4 col-sm-12 col-xs-12'><div class='form-group input-container'><i class='material-icons icons'>flight_takeoff</i><input name='OriginAirportCode' id='" +
                        OriginAirportCodeID +
                        "' class='input-field'  data-airportname='yes' type='text' autocomplete='off' placeholder='Leaving From'></div></div><div class='col-md-4 col-sm-12 col-xs-12'><div class='form-group input-container'><i class='material-icons icons'>flight_land</i><input name='DestinationAirportCode' id='" +
                        DestinationAirportCodeID +
                        "' class='input-field' data-airportname='yes' type='text' autocomplete='off' placeholder='Going To'></div></div><div class='col-md-4 col-sm-12 col-xs-12'><div class='form-group input-container'><i class='material-icons icons'>date_range</i><input id='" +
                        DepartureDateID +
                        "' autocomplete='off' type='text' class='input-field datepicker' placeholder='Departure Date' /><input type='hidden' name='DepartureDate' id='" + DepartureDateID + "Main'/></div></div></div>";

                    $("#multicityarea").append(MulticitySegmentDiv);
                    if (count == 3) {
                        $("#addsegmulticityDiv").hide();
                    }

                    $('#' + DepartureDateID).pickadate({
                        min: new Date(),
                        format: 'dddd, dd mmm, yyyy',
                        formatSubmit: 'yyyy/mm/dd',
                        hiddenName: true,
                        hiddenPrefix: 'prefix__',
                        hiddenSuffix: '',
                        onSet: function (thingSet) {
                            var a = $("#" + DepartureDateID).pickadate('picker');
                            $("#" + DepartureDateID + "Main").val(a.get('select', 'yyyy/mm/dd'));
                        }
                    });

                    AddSearch(OriginAirportCodeID);
                    AddSearch(DestinationAirportCodeID);
                    AddValidation();

                } else {
                    $("#addsegmulticityDiv").hide();
                }

            });


            $("#submitnow").click(function () {

                var Run = true;

                $(".input-field").each(function () {

                    var disabledElement = $(this).prop('disabled');

                    if (disabledElement == false) {

                        var Optional = $(this).data('optional');

                        if (Optional != undefined && Optional == "1") {
                            $(this).removeClass('border');

                        } else {

                            if ($(this).val() == "") {
                                $(this).addClass('border');

                                if ($("#triptypetext").val() != "0") {
                                    if ($(this).get(0).id == "arrivedate") {

                                    } else {
                                        Run = false;
                                    }
                                } else {
                                    Run = false;
                                }

                            } else {
                                $(this).removeClass('border');
                            }

                        }
                    }

                });


                if (Run) {

                    var FrmData = $("#frmsearchflight").serialize();


                    $("#frmsearchflight input").prop('disabled', true);
                    $("#frmsearchflight select").prop('disabled', true);
                    $("#frmsearchflight button").prop('disabled', true);

                    $("#flightsearchpanel").css('opacity', '0.5');
                    $("#flightsearch").css('display', 'block');

                    $.ajax({
                        type: "POST",
                        url: "/Index/TaskRun",
                        data: FrmData,
                        success: function (response) {

                            $("#frmsearchflight input").prop('disabled', false);
                            $("#frmsearchflight select").prop('disabled', false);
                            $("#frmsearchflight button").prop('disabled', false);

                            $('#submitreal').click();
                            if (response != "") {

                                var obj = $.parseJSON(response);

                                if (obj.Code == "200") {
                                    //$('#btnSubmitOff').click();
                                } else {
                                    $("#loadingdivs").hide();
                                    $("#error").html(obj.Message);
                                }

                            } else {
                                window.location.href = "/";
                            }

                        },
                        error: function (response) {
                            $("#frmsearchflight input").prop('disabled', false);
                            $("#frmsearchflight select").prop('disabled', false);
                            $("#frmsearchflight button").prop('disabled', false);
                            $('#submitreal').click();

                        }
                    });

                }

            });


        });


        function AddValidation() {
            $(".input-field").each(function () {
                $(this).unbind('blur');
                $(this).unbind('change');


                var isairporttext = $(this).data('airportname');

                if (isairporttext != undefined) {
                    $(this).unbind('click');

                    $(this).click(function () {
                        $(this).val("");
                        $(this).focus();
                    });

                }


                $(this).blur(function () {
                    var Optional = $(this).data('optional');

                    if (Optional != undefined && Optional == "1") {
                        $(this).removeClass('border');
                    } else {

                        if ($(this).val() == "") {
                            $(this).addClass('border');

                        } else {
                            $(this).removeClass('border');
                        }

                    }
                });

                $(this).change(function () {
                    var Optional = $(this).data('optional');

                    if (Optional != undefined && Optional == "1") {
                        $(this).removeClass('border');
                    } else {

                        if ($(this).val() == "") {
                            $(this).addClass('border');

                        } else {
                            $(this).removeClass('border');
                        }

                    }
                });

            });
        }

        function AddAirlineSearch(ID) {
            var options = {
                url: function (phrase) {
                    return "/Index/GetAllAirlines?AirCode=" + ($("#" + ID).val());
                },
                list: {
                    maxNumberOfElements: 15,
                    match: {
                        enabled: true
                    },
                    onClickEvent: function () {
                        $(".easy-autocomplete-container").each(function () {
                            $(this).children().css('display', 'none');
                        });
                    }
                },
                requestDelay: 500,
                theme: "plate-dark",
                getValue: "name"
            };

            $("#" + ID).easyAutocomplete(options);
        }

        function AddSearch(ID) {
            var options = {
                url: function (phrase) {
                    return "/index/GetAllAirports?AirCode=" + ($("#" + ID).val());
                },
                list: {
                    maxNumberOfElements: 15,
                    match: {
                        enabled: true
                    },
                    onClickEvent: function () {
                        $(".easy-autocomplete-container").each(function () {
                            $(this).children().css('display', 'none');
                        });
                    }
                },
                requestDelay: 500,
                theme: "plate-dark",
                getValue: "name"
            };

            $("#" + ID).easyAutocomplete(options);
        }

        $.ajax({
            url: "https://geoip-db.com/jsonp",
            jsonpCallback: "callback",
            dataType: "jsonp",
            success: function (location) {

                $('#CurrentCity').html(location.city);
            }
        });

        $.post("/Index/GetCheapFlights", function (data) {

            $("#CheapFlightPanelList").html(data);
            $(".cheapflightsbox").click(function () {
                var codeO = $(this).data('flightorigin');
                $("#OriginAirportCode1").val(codeO);
                var codeD = $(this).data('flightdestination');
                $("#DestinationAirportCode1").val(codeD);

                $("#DepartureDate1").val($(this).data('date'))
                $("#airlinename").val($(this).data('airline'))

                //$.ajax({
                //    url: "https://geoip-db.com/jsonp",
                //    jsonpCallback: "callback",
                //    dataType: "jsonp",
                //    success: function (location) {
                //        $('#country').html(location.country_name);
                //        $('#state').html(location.state);
                //        $('#city').html(location.city);
                //        $('#latitude').html(location.latitude);
                //        $('#longitude').html(location.longitude);
                //        $('#ip').html(location.IPv4);
                //    }
                //});

                $("#arrivedate").focus();
            });
        });


    </script>

}